
{% extends 'app/base.html' %}

{% block content %}

    <div class="home-container">
        <div class="container-wk-grp">
            <button class="btn btn-custom"  data-bs-toggle="modal" data-bs-target="#workoutModal">Show Workout Groups</button>
        </div>
    
    
        <div class="create-wk-session">
            <h2>Create Workout Session</h2>
            
                <form id="sessionForm">
                {% csrf_token %}
        
                <label for="group">Workout Group:</label>
                <select name="workout_group" id="group" class="form-control" multiple required>
                    <option value="" selected disabled>Choose a workout group</option>
                    {% for group in groups %}
                    <option value="{{ group.id }}">{{ group.group }}</option>
                    {% endfor %}
                </select>
        
                <label for="date">Session Date:</label>
                <input type="date" name="session_date" id="date" class="form-control" required>
        
                <br>
                <button type="submit" class="btn btn-custom">Save</button>
                </form>
        </div>

        <div id="responseMessage" class="mt-3"></div>

        <hr>

        <h2>Workout Sessions</h2>

        <table class="table table-striped table-bordered table-hover">
        <thead class="table-dark">
            <tr>
            <th>Date</th>
            <th>Workout Group</th>
            </tr>
        </thead>
        <tbody id="sessions-body">
            <!-- Will be filled by JS -->
        </tbody>
        </table>











        <div class="table-perso-best">
            <h2>Personal Best</h2>

            <!-- Filter -->
            <input type="text" id="exerciseFilter" class="form-control mb-3" placeholder="Filter exercises...">

            <!-- Table -->
            <table class="table table-striped table-bordered table-hover">
                <thead class="table-dark">
                    <tr>
                        <th>Group</th>
                        <th>Exercise</th>
                        <th>UOM</th>
                        <th>Max</th>
                    </tr>
                </thead>
                <tbody id="exerciseTable">
                    {% for item in exercises %}
                    <tr>
                        <td>{{ item.workout_group.group }}</td>
                        <td>{{ item.exercise }}</td>
                        <td>{{ item.uom }}</td>
                        <td>{{ item.max_weight }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>


    

{% endblock %}



{% block modal_content %}

    {% for group in groups %}

        <li>{{ group.group }}</li>

    {% endfor %}

{% endblock %}

{% block extra_scripts %}
<script>


// Multi Select Filter
$(document).ready(function() {
    $('#group').multiselect({
        includeSelectAllOption: true,
        nonSelectedText: 'Choose workout groups',
        enableFiltering: true,
        buttonWidth: '100%'
    });
});


// Submit form
document.getElementById('sessionForm').addEventListener('submit', function(e) {
    e.preventDefault(); // Prevent normal form submission

    const form = this;
    const formData = new FormData(form);

    fetch("{% url 'save-session' %}", {
        method: "POST",
        body: formData,
        headers: {
            'X-CSRFToken': form.querySelector('[name=csrfmiddlewaretoken]').value
        }
    })
    .then(response => response.json())
    .then(data => {
        const msgDiv = document.getElementById('responseMessage');
        if (data.status === 'success') {
            msgDiv.innerHTML = `<div class="alert alert-success">${data.message}</div>`;

            // Reset the form
            form.reset();

            // If using a multi-select dropdown plugin, also reset it:
            $('#group').multiselect('deselectAll', false);
            $('#group').multiselect('updateButtonText');

            // Auto-hide after 3 seconds
            setTimeout(() => {
                msgDiv.innerHTML = '';
            }, 2000);


        } else {
            msgDiv.innerHTML = `<div class="alert alert-danger">${data.message}</div>`;
        }
    })
    .catch(err => console.error("Error:", err));
});

// Load sessions and render table
  function loadSessions() {
    fetch("{% url 'sessions-list' %}")
      .then(res => res.json())
      .then(data => {
        const tbody = document.getElementById('sessions-body');
        tbody.innerHTML = data.sessions.map(s => `
          <tr data-id="${s.id}">
            <td>${s.date}</td>
            <td>${s.group}</td>
          </tr>
        `).join('');
      })
      .catch(err => console.error(err));
  }








document.getElementById('exerciseFilter').addEventListener('keyup', function() {
    const filter = this.value.toLowerCase();
    const rows = document.querySelectorAll('#exerciseTable tr');

    rows.forEach(row => {
        const text = row.textContent.toLowerCase();
        row.style.display = text.includes(filter) ? '' : 'none';
    });
});





</script>
{% endblock %}

